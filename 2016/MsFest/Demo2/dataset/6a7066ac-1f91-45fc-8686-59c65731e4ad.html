<html lang="cs" xml:lang="cs" xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://opengraphprotocol.org/schema" xmlns:twitter="http://api.twitter.com/"> <head> <title>Dajbych.net</title> <meta charset="utf-8" /> <meta name="viewport" content="width=device-width" /> <link rel="stylesheet" href="/style.css" /> <link rel="icon" type="image/x-icon" href="/design/favicon.ico" /> <meta name="application-name" content="Dajbych.net" /> <meta name="msapplication-config" content="/browserconfig/en" /> <meta name="msapplication-starturl" content="https://dajbych.net/blog/en" /> <meta name="msapplication-tap-highlight" content="no" /> <meta name="description" content="Ja­vaScript je ja­zyk mi­lo­vaný i opo­vr­ho­vaný, rychlý i po­malý, v zá­vis­losti na tom, jak mu pro­gramá­toři ro­zumí, jak ho po­u­ží­vají a jak…" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:url" content="https://dajbych.net/projekt-spartan-4-dil-vylepseni-v-javascriptu" /> <meta name="twitter:title" content="Projekt Spartan, 4. díl – vylepšení v JavaScriptu" /> <meta name="twitter:description" content="Ja­vaScript je ja­zyk mi­lo­vaný i opo­vr­ho­vaný, rychlý i po­malý, v zá­vis­losti na tom, jak mu…" /> <meta name="twitter:image" content="https://dajbych.net/assets/square-150x150.png" /> <meta name="twitter:creator" content="@Dajbych" /> <meta property="og:url" content="https://dajbych.net/projekt-spartan-4-dil-vylepseni-v-javascriptu" /> <meta property="og:title" content="Projekt Spartan, 4. díl – vylepšení v JavaScriptu" /> <meta property="og:description" content="Ja­vaScript je ja­zyk mi­lo­vaný i opo­vr­ho­vaný, rychlý i po­malý, v zá­vis­losti na tom, jak mu pro­gramá­toři ro­zumí, jak ho po­u­ží­vají a jak moc jsou nu­ceni ho po­u­ží­vat. Nelze mu upřít fakt, že je nej­roz­šíře­nější, jenže to na webu zna­mená brzdu v dal­ším vý­voji. Růz­no­rodé…" /> <meta property="og:image" content="https://dajbych.net/assets/square-310x310.png" /> <script type="text/javascript" src="/scripts/syntax.js" /> </head> <body itemscope="itemscope" itemtype="http://schema.org/TechArticle"> <header> <div> <h1><a href="/" rel="home">Dajbych.net</a></h1> </div> <hr /> <h2 class="article" itemprop="headline">Projekt Spartan, 4. díl – vylepšení v JavaScriptu</h2> <p><time datetime="2015-03-01 23:00:00Z">březen 2015</time>, 7 minut čtení</p> </header> <article itemprop="articleBody"><meta itemprop="datePublished" content="2015-03-01T23:00:00" /><meta itemprop="dateModified" content="2015-07-30T10:38:00" /><section><p class="perex" itemprop="description">Ja­vaScript je ja­zyk mi­lo­vaný i opo­vr­ho­vaný, rychlý i po­malý, v zá­vis­losti na tom, jak mu pro­gramá­toři ro­zumí, jak ho po­u­ží­vají a jak moc jsou nu­ceni ho po­u­ží­vat. Nelze mu upřít fakt, že je nej­roz­šíře­nější, jenže to na webu zna­mená brzdu v dal­ším vý­voji. Růz­no­rodé vyu­žití si žádá roz­ličné po­ža­davky, které ústí v roz­ma­nitá ře­šení. Ja­vaScript se mění jed­nak v ob­jek­tově ori­en­to­vaný ja­zyk – ES6 a jed­nak v byte code – asm.js. Javascrip­tový en­gine Cha­kra bude pod­po­ro­vat oboje.</p><p class="indented">V <a href="https://dajbych.net/projekt-spartan-3-dil-nove-jadro">mi­nulém díle</a> byla řeč o no­vém já­dru další verze In­ter­net Ex­plo­reru. Tento díl se na pro­hlí­žeč dívá jako na soft­wa­ro­vou vrstvu, která za­jiš­ťuje běh <a href="https://www.webplatform.org/" target="_blank">we­bové plat­formy</a>.</p><p class="indented">Ja­vaScript je sice ustá­lený ná­zev, ale nejdříve se tento ja­zyk na­zý­val Mo­cha, poz­ději Li­ve­Script a nyní je správný ná­zev <a href="https://en.wikipedia.org/wiki/ECMAScript" target="_blank">EC­MAScript</a>, což je ná­zev pro stan­dar­di­zo­va­nou po­dobu Ja­vaScriptu. Stan­dar­di­zace ne­spadá pod W3 kon­sor­cium, ale pod <a href="https://en.wikipedia.org/wiki/Ecma_International" target="_blank">ECMA</a> (Ev­rop­ské sdru­žení výrobců po­čítačů). Au­tor Ja­vaScriptu Bren­dan Eich je dnes ře­di­te­lem Mo­zilly. Stu­do­val na uni­ver­zitě v Il­li­nois v kam­pusu <a href="https://en.wikipedia.org/wiki/University_of_Illinois_at_Urbana–Champaign" target="_blank">Ur­bana–Cham­paign</a>, ve kte­rém <a href="https://dajbych.net/projekt-spartan-1-dil-dejiny-internet-exploreru-v-kostce">vznikl pro­hlí­žeč Mosaic</a>.</p><h3>ES6</h3><p>Šestá verze ESMAScriptu umož­ňuje po­u­žít mnoho no­vých kon­struktů:</p><ul> <li>Třídy</li> <li>Výchozí hod­noty pa­ra­me­trů funkcí</li> <li>Ge­ne­rá­tory</li> <li>Ite­rá­tory</li> <li>Pro­mise ob­jekty</li> <li>Proxy ob­jekty</li> </ul><p>Při­by­dou i ve­sta­věné funkce:</p><ul> <li>String – co­de­Poin­tAt, nor­ma­lize, re­peat, start­sWith, end­sWith, con­ta­ins</li> <li>Math – sign, trunc, sinh, cosh, tanh, asinh, acosh, atanh, log10, log2, hy­pot, fround, clz32, cbrt, log1p, expm1</li> <li>Ob­ject – as­sign, is, ge­tOw­n­Pro­per­ty­Sym­bols, set­Pro­to­ty­peOf</li> </ul><p>Bude tak možné psát po­ho­dl­nější ruční kód a zá­ro­veň <a href="http://www.typescriptlang.org/" target="_blank">Ty­pe­Script</a> bude moci pod­po­ro­vat <em>async</em><em>/</em><em>await</em>.</p><h3>asm.js</h3><p>Jestliže Ty­pe­Script chá­peme jako nad­mno­žinu Ja­vaScriptu, pak <a href="https://en.wikipedia.org/wiki/Asm.js" target="_blank">asm.js</a> je jeho pod­mno­ži­nou. A to po­měrně pri­mi­tivní. Prav­dě­po­dobně není na Zemi více než 5 lidí, kteří do­káží ručně psát va­lidní asm.js kód. Před­ností asm.js je však to, že ho lze pře­lo­žit do byte kódu okamžitě. Může se tak obe­jít <a href="https://en.wikipedia.org/wiki/Just-in-time_compilation" target="_blank">JIT</a> a tím se zvýší vý­kon na­to­lik, že může být <a href="https://www.youtube.com/watch?v=BV32Cs_CMqo" target="_blank">do pro­hlí­žeče por­to­ván Unreal 3</a> nebo <a href="https://www.youtube.com/watch?v=c2uNDlP4RiE" target="_blank">Unreal 4 en­gine</a>.</p><p class="indented">Stačí k tomu pře­pí­nač <em>&quot;use </em><em>asm</em><em>&quot; </em>a op­ti­ma­li­zace v pro­hlí­žeči. Pro­tože je zacho­vána zpětná kom­pa­ti­bi­lita s Ja­vaScrip­tem, asm.js fun­guje te­o­re­ticky už dnes ve všech mo­der­ních pro­hlí­že­čích. Prak­ticky však ne do­sta­tečně rychle. Herní en­giny na­psané v C++ <a href="https://en.wikipedia.org/wiki/Emscripten" target="_blank">mo­hou být zkom­pi­lo­vány do asm.js</a> a vy­kres­lo­vat v pro­hlí­žeči přes We­bGL. Vzniká tím uni­ver­zální we­bová herní plat­forma.</p><h3>Pointer Events</h3><p>Pro­gra­mo­vací ja­zyk sám o sobě ne­stačí. Je po­třeba re­a­go­vat na vstupy. We­bové API byly na­vr­ženy pro ovlá­dání myší, jenže dnes je si­tuace jiná. Web ne­běží jen na PC, ale i na te­le­fo­nech, table­tech i her­ních kon­zo­lích. Micro­soft proto na­vrhl API pro zpra­co­vání nej­růz­něj­ších ovlá­da­cích vstupů na­zvané Poin­ter Events. Mo­zilla toto API im­ple­men­to­vala v pro­hlí­žeči Fi­re­fox.</p></section><figure itemprop="image" itemscope="itemscope" itemtype="http://schema.org/ImageObject"><img width="400" height="297" src="/image/projekt-spartan-4-dil-vylepseni-v-javascriptu.image1.png" class="border" /><meta itemprop="url" content="http://dajbych.net/image/projekt-spartan-4-dil-vylepseni-v-javascriptu.image1.png" /><meta itemprop="width" content="400" /><meta itemprop="height" content="297" /></figure><section><p>Tato tabulka ob­sahuje se­znam udá­lostí, které Poin­ter Events (HTML5) za­vá­dějí, a uvádí je­jich nej­bližší ekvi­valenty z Win­dows Run­time (WinRT) i z .NET Fra­meworku (WPF).</p></section><table><tbody><tr> <th>HTML5</th> <th>WinRT</th> <th>WPF</th> </tr><tr> <td>poin­te­ro­ver</td> <td>Poin­te­rEn­te­red</td> <td>Tou­chEn­ter, Mou­se­En­ter, StylusEn­ter</td> </tr><tr> <td>poin­te­ren­ter</td> <td>Poin­te­rEn­te­red</td> <td>Tou­chEn­ter, Mou­se­En­ter, StylusEn­ter</td> </tr><tr> <td>poin­ter­down</td> <td>Poin­ter­Pres­sed</td> <td>Touch­Down, Mou­se­Down, StylusDown</td> </tr><tr> <td>poin­ter­move</td> <td>Poin­ter­Mo­ved</td> <td>TouchMove, Mou­se­Move, StylusMove</td> </tr><tr> <td>poin­te­rup</td> <td>Poin­terRe­le­a­sed</td> <td>Tou­chUp, Mou­seUp, StylusUp</td> </tr><tr> <td>poin­ter­can­cel</td> <td>Poin­ter­Can­ce­led</td> <td>Mou­se­Leave, TouchLeave, Stylus­Leave</td> </tr><tr> <td>poin­te­rout</td> <td>Poin­te­rExi­ted</td> <td>Mou­se­Leave, TouchLeave, Stylus­Leave</td> </tr><tr> <td>poin­ter­leave</td> <td>Poin­te­rExi­ted</td> <td>Mou­se­Leave, TouchLeave, Stylus­Leave</td> </tr><tr> <td>got­poin­ter­cap­ture</td> <td>Poin­ter­Mo­ved</td> <td>StylusInRange</td> </tr><tr> <td>lost­poin­ter­cap­ture</td> <td>Poin­ter­Cap­tu­re­Lost</td> <td>StylusI­nAir­Move</td> </tr></tbody></table><section><p /><p class="indented">V .NET Fra­meworku má každý typ vstup­ního za­ří­zení svoje zvláštní udá­losti. Tento přístup se ve Win­dows Run­time změ­nil. Exis­tují v něm spo­lečné udá­losti pro všechny typy vstupu. Tento přístup by Micro­soft rád vi­děl i na webu.</p><p class="indented">Mů­žete si všim­nout, že udá­lost pro <em>e</em><em>nter </em>re­spek­tive <em>l</em><em>eave</em> se v HTML5 roz­li­šuje na <em>o</em><em>ver</em> a <em>e</em><em>nter</em> re­spek­tive <em>o</em><em>ut</em> a <em>l</em><em>eave</em>. HTML5 roz­li­šuje udá­lost sa­mot­ného ele­mentu (<em>o</em><em>ver</em> a <em>o</em><em>ut</em>) od udá­losti ele­mentu se všemi jeho vno­ře­nými ele­menty (<em>e</em><em>nter</em> a <em>l</em><em>eave</em>).</p><h3>WebRTC</h3><p>Vstupy nejsou jen od myší, klá­ves­nic, stylusů, nebo do­ty­kové, ale i hla­sové. Hla­sové vstupy zprostřed­ko­vává pro­hlí­žeč we­bové apli­kaci po­mocí API zva­ného jako We­bRTC. Zatímco Chrome, Fi­re­fox i Opera už toto API pod­po­rují, In­ter­net Ex­plo­rer zatím nic takového ne­umí. Je to však po­třeba. Bingu nejde vyhle­dá­vací do­taz za­dat hla­sově. Proto vyhle­dá­vání na Win­dows Phone spustí na­tivní apli­kaci, místo toho, aby se spus­tila apli­kace we­bová.</p><p class="indented">We­bRTC má dvě verze, starší We­bRTC v1.0 a no­vější Ob­ject RTC. We­bRTC v1.0 pod­po­ruje Chrome, Fi­re­fox a Opera. In­ter­net Ex­plo­rer bude pod­po­ro­vat no­vější va­ri­antu Ob­ject RTC.</p><h3>Media Capture and Streams</h3><p>Dal­ším API je <em>na­vi­ga­tor.</em><em>ge­tUser­Me­dia</em>, které je na­vr­ženo pro zob­ra­zení ob­razu z ka­mer za­po­je­ných do stejné sítě, jako pra­covní sta­nice. Sou­visí s tím i pod­pora vi­deo for­mátu MJPG, který je po­pulární právě v IP ka­me­rách. Proud dat z ka­mery jde vy­kres­lit v ele­mentu <em>vi­deo</em>. We­bová kon­fi­gu­race IP ka­mery tak bude schopná zob­ra­zit její ob­raz přímo.</p><h3>GamePad API</h3><p>Herní kon­zole mají spe­ci­fický hard­ware pro vstup. Zatímco na PC se hraje po­mocí myši, klá­ves­nice, joysticku nebo vo­lantu, ga­me­pad má dva malé joysticky a víc tla­čí­tek než myš, ale zase ne to­lik, ko­lik má klá­ves­nice. API pro zpra­co­vání vstupu z ga­me­padu <em>na­vi­ga­tor.get­Ga­me­pads</em> ne­u­mož­ňuje ani tak ovlá­dání we­bo­vých her na PC po­mocí při­po­je­ného ga­me­padu, jako spíše mož­nost cílení we­bo­vých her i na herní kon­zole.</p><h3>Pointer Lock</h3><p>Cílení we­bo­vých her na kon­zole je pěkné, ale zatím nejde po­řádně cí­lit we­bové hry ani na PC. Tomu má po­moct me­toda <em>request­Poin­ter­Lock</em>, která změní cho­vání kur­zoru. Místo po­sou­vání nudné šipky se bude otá­čet po­hled na scénu ve hře. Umožní to ovlá­dat po­hled hráče ve hře po­mocí po­hybu myši.</p><p class="indented"> <a href="https://dajbych.net/projekt-spartan-5-dil-windows-api-pro-webove-aplikace">5. díl – Win­dows API pro we­bové apli­kace</a> </p></section><div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Dajbych.net" /><div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="http://dajbych.net/assets/wide-300x60.png" /><meta itemprop="width" content="300" /><meta itemprop="height" content="60" /></div></div></article> <footer> <section class="tags"> <h3>Štítky</h3> <p class="tags"> <a href="/tag/Spartan" rel="tag">Spartan</a> <a href="/tag/Edge" rel="tag">Edge</a> </p> </section> <section class="author"> <p itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"> <img src="/design/mvp.png" width="94" height="148" alt="Microsoft MVP" /> napsal <span itemprop="name">Václav Dajbych</span>, <a href="https://mvp.microsoft.com/en-us/mvp/V%C3%A1clav%20Dajbych-5000527" target="_blank" rel="nofollow">Microsoft <abbr title="Most Valuable Professional">MVP</abbr></a> <br /> softwarový vývojář, školitel a konzultant <br /> <a id="em" /> <script type="text/javascript" async="async">
                if (typeof(atob) == &apos;undefined&apos;) {
                    function atob(s) {
                        var e = {}, i, k, v = [], r = &apos;&apos;, w = String.fromCharCode;
                        var n = [[65, 91], [97, 123], [48, 58], [43, 44], [47, 48]];
                        for (z in n) {
                            for (i = n[z][0]; i &amp;lt; n[z][1]; i++) {
                                v.push(w(i));
                            }
                        }
                        for (i = 0; i &amp;lt; 64; i++) {
                            e[v[i]] = i;
                        }
                        for (i = 0; i &amp;lt; s.length; i += 72) {
                            var b = 0, c, x, l = 0, o = s.substring(i, i + 72);
                            for (x = 0; x &amp;lt; o.length; x++) {
                                c = e[o.charAt(x)];
                                b = (b &amp;lt;&amp;lt; 6) + c;
                                l += 6;
                                while (l &amp;gt;= 8) {
                                    r += w((b &amp;gt;&amp;gt;&amp;gt; (l -= 8)) % 256);
                                }
                            }
                        }
                        return r;
                    }
                }
                var em = document.getElementById(&apos;em&apos;);
                em.innerText = atob(&apos;dmFjbGF2QGRhamJ5Y2gubmV0&apos;);
                em.setAttribute(&apos;href&apos;, &apos;mailto:&apos; + em.innerText);
            </script> </p> </section> <section class="misc"> <div class="flex"> <div class="subscribe"> <h3>Odebírat</h3> <p class="socialite"> <a class="twitter" href="https://twitter.com/Dajbych" target="_blank" rel="nofollow"></a> <a class="feed" target="_blank" rel="nofollow"></a> </p> </div> <div class="share"> <h3>Sdílet</h3> <p class="socialite"> <a class="twitter" href="https://twitter.com/intent/tweet?text=Projekt+Spartan%2C+4.+d%C3%ADl+%E2%80%93+vylep%C5%A1en%C3%AD+v+JavaScriptu&url=https%3A%2F%2Fdajbych.net%2Fprojekt-spartan-4-dil-vylepseni-v-javascriptu" target="_blank" rel="nofollow"></a> <a class="facebook" href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fdajbych.net%2Fprojekt-spartan-4-dil-vylepseni-v-javascriptu&t=Projekt+Spartan%2C+4.+d%C3%ADl+%E2%80%93+vylep%C5%A1en%C3%AD+v+JavaScriptu" target="_blank" rel="nofollow"></a> <a class="linkedin" href="https://www.linkedin.com/shareArticle?miniu=true&url=https%3A%2F%2Fdajbych.net%2Fprojekt-spartan-4-dil-vylepseni-v-javascriptu&title=Projekt+Spartan%2C+4.+d%C3%ADl+%E2%80%93+vylep%C5%A1en%C3%AD+v+JavaScriptu" target="_blank" rel="nofollow"></a> <a class="gplus" href="https://plus.google.com/share?url=https%3A%2F%2Fdajbych.net%2Fprojekt-spartan-4-dil-vylepseni-v-javascriptu" target="_blank" rel="nofollow"></a> <a class="reddit" href="https://www.reddit.com/submit?url=https%3A%2F%2Fdajbych.net%2Fprojekt-spartan-4-dil-vylepseni-v-javascriptu&title=Projekt+Spartan%2C+4.+d%C3%ADl+%E2%80%93+vylep%C5%A1en%C3%AD+v+JavaScriptu" target="_blank" rel="nofollow"></a> </p> </div> </div> <div class="reco"> <h3>Další</h3> <p class="reco"> <ul> <li> <a href="/aktualizace-ie-9-0-9-na-windows-update"> <span> <img src="/logos/windows-update.png" draggable="false" alt="windows update" /> </span> <span>Aktualizace IE 9.0.9 na Windows Update</span> </a> </li> <li> <a href="/projekt-spartan-3-dil-nove-jadro"> <span> <img src="/logos/spartan.png" draggable="false" alt="spartan" /> </span> <span>Projekt Spartan, 3. díl – nové jádro</span> </a> </li> <li> <a href="/projekt-spartan-5-dil-windows-api-pro-webove-aplikace"> <span> <img src="/logos/spartan.png" draggable="false" alt="spartan" /> </span> <span>Projekt Spartan, 5. díl – Windows API pro webové aplikace</span> </a> </li> <li> <a href="/projekt-spartan-2-dil-prohlizec-v-korporaci"> <span> <img src="/logos/spartan.png" draggable="false" alt="spartan" /> </span> <span>Projekt Spartan, 2. díl – prohlížeč v korporaci</span> </a> </li> </ul> </p> </div> </section> <section class="disqus"> <div id="disqus_thread" /> <script type="text/javascript" async="async">
                    var disqus_shortname = &apos;dajbych&apos;;
                    (function () { var dsq = document.createElement(&apos;script&apos;); dsq.type = &apos;text/javascript&apos;; dsq.async = true; dsq.src = &apos;//&apos; + disqus_shortname + &apos;.disqus.com/embed.js&apos;; (document.getElementsByTagName(&apos;head&apos;)[0] || document.getElementsByTagName(&apos;body&apos;)[0]).appendChild(dsq); })();
                </script> </section> <section> <div id="footer1" /> <div id="footer2"> <p>Spuštěním webového prohlížeče s vypnutým posíláním žádosti Do Not Track (Nesledovat) udělujete souhlas s použitím souborů cookie.</p> </div> </section> <environment names="Production"> <script type="text/javascript" async="async">
                (function (i, s, o, g, r, a, m) { i[&apos;GoogleAnalyticsObject&apos;] = r; i[r] = i[r] || function () { (i[r].q = i[r].q || []).push(arguments) }, i[r].l = 1 * new Date(); a = s.createElement(o), m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m) })(window, document, &apos;script&apos;, &apos;//www.google-analytics.com/analytics.js&apos;, &apos;ga&apos;);
                ga(&apos;create&apos;, &apos;UA-2191362-10&apos;, &apos;dajbych.net&apos;);
ga(&apos;set&apos;, &apos;dimension1&apos;, &apos;Front End Web Dev&apos;);                ga(&apos;send&apos;, &apos;pageview&apos;);
                </script> </environment> </footer> </body> </html>